/**
 * Internationalization Manager - Multi-Language Support
 *
 * Provides comprehensive multi-language support with 10+ languages,
 * RTL support, dynamic language switching, and localization features
 */

const EventEmitter = require('events');
const logger = require('../../utils/logger');


class InternationalizationManager extends EventEmitter {
  constructor() {
    super();
    this.isInitialized = false;
    this.supportedLanguages = new Map();
    this.currentLanguage = 'en';
    this.fallbackLanguage = 'en';
    this.translations = new Map();
    this.rtlLanguages = new Set(['ar', 'he', 'fa', 'ur']);
    this.pluralizationRules = new Map();
    this.dateFormats = new Map();
    this.numberFormats = new Map();
    this.currencyFormats = new Map();
  }

  async initialize() {
    try {
      logger.info('üåç Initializing Internationalization Manager...');

      await this.initializeSupportedLanguages();
      await this.loadTranslations();
      await this.initializeFormats();
      await this.setupPluralizationRules();

      this.isInitialized = true;
      logger.info(`‚úÖ Internationalization Manager initialized with ${this.supportedLanguages.size} languages`);

      return { success: true, message: 'Internationalization manager initialized' };
    } catch (error) {
      logger.error('Internationalization manager initialization failed:', error);
      throw error;
    }
  }

  async shutdown() {
    try {
      this.isInitialized = false;
      logger.info('Internationalization Manager shut down');
      return { success: true, message: 'Internationalization manager shut down' };
    } catch (error) {
      logger.error('Internationalization manager shutdown failed:', error);
      throw error;
    }
  }

  async initializeSupportedLanguages() {
    // English (US)
    this.supportedLanguages.set('en', {
      code: 'en',
      name: 'English',
      nativeName: 'English',
      region: 'US',
      direction: 'ltr',
      enabled: true,
      completeness: 100
    });

    // Spanish (Spain)
    this.supportedLanguages.set('es', {
      code: 'es',
      name: 'Spanish',
      nativeName: 'Espa√±ol',
      region: 'ES',
      direction: 'ltr',
      enabled: true,
      completeness: 95
    });

    // French (France)
    this.supportedLanguages.set('fr', {
      code: 'fr',
      name: 'French',
      nativeName: 'Fran√ßais',
      region: 'FR',
      direction: 'ltr',
      enabled: true,
      completeness: 90
    });

    // German (Germany)
    this.supportedLanguages.set('de', {
      code: 'de',
      name: 'German',
      nativeName: 'Deutsch',
      region: 'DE',
      direction: 'ltr',
      enabled: true,
      completeness: 88
    });

    // Italian (Italy)
    this.supportedLanguages.set('it', {
      code: 'it',
      name: 'Italian',
      nativeName: 'Italiano',
      region: 'IT',
      direction: 'ltr',
      enabled: true,
      completeness: 85
    });

    // Portuguese (Brazil)
    this.supportedLanguages.set('pt', {
      code: 'pt',
      name: 'Portuguese',
      nativeName: 'Portugu√™s',
      region: 'BR',
      direction: 'ltr',
      enabled: true,
      completeness: 82
    });

    // Russian (Russia)
    this.supportedLanguages.set('ru', {
      code: 'ru',
      name: 'Russian',
      nativeName: '–†—É—Å—Å–∫–∏–π',
      region: 'RU',
      direction: 'ltr',
      enabled: true,
      completeness: 80
    });

    // Chinese (Simplified)
    this.supportedLanguages.set('zh', {
      code: 'zh',
      name: 'Chinese (Simplified)',
      nativeName: '‰∏≠Êñá (ÁÆÄ‰Ωì)',
      region: 'CN',
      direction: 'ltr',
      enabled: true,
      completeness: 78
    });

    // Japanese (Japan)
    this.supportedLanguages.set('ja', {
      code: 'ja',
      name: 'Japanese',
      nativeName: 'Êó•Êú¨Ë™û',
      region: 'JP',
      direction: 'ltr',
      enabled: true,
      completeness: 75
    });

    // Korean (South Korea)
    this.supportedLanguages.set('ko', {
      code: 'ko',
      name: 'Korean',
      nativeName: 'ÌïúÍµ≠Ïñ¥',
      region: 'KR',
      direction: 'ltr',
      enabled: true,
      completeness: 73
    });

    // Arabic (Saudi Arabia)
    this.supportedLanguages.set('ar', {
      code: 'ar',
      name: 'Arabic',
      nativeName: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',
      region: 'SA',
      direction: 'rtl',
      enabled: true,
      completeness: 70
    });

    logger.info(`‚úÖ Initialized ${this.supportedLanguages.size} supported languages`);
  }

  async loadTranslations() {
    // Load English translations (base)
    this.translations.set('en', this.getEnglishTranslations());

    // Load other language translations
    this.translations.set('es', this.getSpanishTranslations());
    this.translations.set('fr', this.getFrenchTranslations());
    this.translations.set('de', this.getGermanTranslations());
    this.translations.set('it', this.getItalianTranslations());
    this.translations.set('pt', this.getPortugueseTranslations());
    this.translations.set('ru', this.getRussianTranslations());
    this.translations.set('zh', this.getChineseTranslations());
    this.translations.set('ja', this.getJapaneseTranslations());
    this.translations.set('ko', this.getKoreanTranslations());
    this.translations.set('ar', this.getArabicTranslations());

    logger.info(`‚úÖ Loaded translations for ${this.translations.size} languages`);
  }

  getEnglishTranslations() {
    return {
      // Navigation
      'nav.dashboard': 'Dashboard',
      'nav.trading': 'Trading',
      'nav.portfolio': 'Portfolio',
      'nav.market': 'Market',
      'nav.ai': 'AI Insights',
      'nav.analytics': 'Analytics',
      'nav.settings': 'Settings',
      'nav.profile': 'Profile',
      'nav.logout': 'Logout',

      // Trading
      'trading.buy': 'Buy',
      'trading.sell': 'Sell',
      'trading.quantity': 'Quantity',
      'trading.price': 'Price',
      'trading.total': 'Total',
      'trading.order_type': 'Order Type',
      'trading.market': 'Market',
      'trading.limit': 'Limit',
      'trading.stop': 'Stop',
      'trading.execute': 'Execute Trade',
      'trading.cancel': 'Cancel',
      'trading.confirm': 'Confirm Trade',

      // Portfolio
      'portfolio.total_value': 'Total Value',
      'portfolio.day_change': 'Day Change',
      'portfolio.total_return': 'Total Return',
      'portfolio.assets': 'Assets',
      'portfolio.distribution': 'Distribution',
      'portfolio.performance': 'Performance',

      // Market
      'market.price': 'Price',
      'market.change': 'Change',
      'market.volume': 'Volume',
      'market.market_cap': 'Market Cap',
      'market.24h_high': '24h High',
      'market.24h_low': '24h Low',

      // AI
      'ai.predictions': 'AI Predictions',
      'ai.sentiment': 'Market Sentiment',
      'ai.recommendations': 'Recommendations',
      'ai.risk_assessment': 'Risk Assessment',
      'ai.portfolio_optimization': 'Portfolio Optimization',

      // Common
      'common.loading': 'Loading...',
      'common.error': 'Error',
      'common.success': 'Success',
      'common.warning': 'Warning',
      'common.info': 'Information',
      'common.confirm': 'Confirm',
      'common.cancel': 'Cancel',
      'common.save': 'Save',
      'common.edit': 'Edit',
      'common.delete': 'Delete',
      'common.search': 'Search',
      'common.filter': 'Filter',
      'common.sort': 'Sort',
      'common.refresh': 'Refresh',
      'common.export': 'Export',
      'common.import': 'Import',
      'common.download': 'Download',
      'common.upload': 'Upload',

      // Authentication
      'auth.login': 'Login',
      'auth.register': 'Register',
      'auth.email': 'Email',
      'auth.password': 'Password',
      'auth.confirm_password': 'Confirm Password',
      'auth.forgot_password': 'Forgot Password?',
      'auth.reset_password': 'Reset Password',
      'auth.two_factor': 'Two-Factor Authentication',
      'auth.verify_email': 'Verify Email',

      // Settings
      'settings.language': 'Language',
      'settings.currency': 'Currency',
      'settings.timezone': 'Timezone',
      'settings.notifications': 'Notifications',
      'settings.privacy': 'Privacy',
      'settings.security': 'Security',
      'settings.preferences': 'Preferences',

      // Notifications
      'notification.trade_executed': 'Trade Executed',
      'notification.price_alert': 'Price Alert',
      'notification.portfolio_update': 'Portfolio Update',
      'notification.market_news': 'Market News',
      'notification.system_alert': 'System Alert',

      // Errors
      'error.network': 'Network Error',
      'error.unauthorized': 'Unauthorized Access',
      'error.forbidden': 'Access Forbidden',
      'error.not_found': 'Not Found',
      'error.server_error': 'Server Error',
      'error.validation': 'Validation Error',
      'error.insufficient_funds': 'Insufficient Funds',
      'error.invalid_symbol': 'Invalid Symbol',
      'error.market_closed': 'Market Closed'
    };
  }

  getSpanishTranslations() {
    return {
      'nav.dashboard': 'Panel de Control',
      'nav.trading': 'Trading',
      'nav.portfolio': 'Cartera',
      'nav.market': 'Mercado',
      'nav.ai': 'Insights IA',
      'nav.analytics': 'Anal√≠ticas',
      'nav.settings': 'Configuraci√≥n',
      'nav.profile': 'Perfil',
      'nav.logout': 'Cerrar Sesi√≥n',
      'trading.buy': 'Comprar',
      'trading.sell': 'Vender',
      'trading.quantity': 'Cantidad',
      'trading.price': 'Precio',
      'trading.total': 'Total',
      'trading.execute': 'Ejecutar Operaci√≥n',
      'common.loading': 'Cargando...',
      'common.error': 'Error',
      'common.success': '√âxito'
    };
  }

  getFrenchTranslations() {
    return {
      'nav.dashboard': 'Tableau de Bord',
      'nav.trading': 'Trading',
      'nav.portfolio': 'Portefeuille',
      'nav.market': 'March√©',
      'nav.ai': 'Insights IA',
      'nav.analytics': 'Analyses',
      'nav.settings': 'Param√®tres',
      'nav.profile': 'Profil',
      'nav.logout': 'D√©connexion',
      'trading.buy': 'Acheter',
      'trading.sell': 'Vendre',
      'trading.quantity': 'Quantit√©',
      'trading.price': 'Prix',
      'trading.total': 'Total',
      'trading.execute': 'Ex√©cuter la Transaction',
      'common.loading': 'Chargement...',
      'common.error': 'Erreur',
      'common.success': 'Succ√®s'
    };
  }

  getGermanTranslations() {
    return {
      'nav.dashboard': 'Dashboard',
      'nav.trading': 'Trading',
      'nav.portfolio': 'Portfolio',
      'nav.market': 'Markt',
      'nav.ai': 'KI-Erkenntnisse',
      'nav.analytics': 'Analysen',
      'nav.settings': 'Einstellungen',
      'nav.profile': 'Profil',
      'nav.logout': 'Abmelden',
      'trading.buy': 'Kaufen',
      'trading.sell': 'Verkaufen',
      'trading.quantity': 'Menge',
      'trading.price': 'Preis',
      'trading.total': 'Gesamt',
      'trading.execute': 'Handel Ausf√ºhren',
      'common.loading': 'Wird geladen...',
      'common.error': 'Fehler',
      'common.success': 'Erfolg'
    };
  }

  getItalianTranslations() {
    return {
      'nav.dashboard': 'Dashboard',
      'nav.trading': 'Trading',
      'nav.portfolio': 'Portafoglio',
      'nav.market': 'Mercato',
      'nav.ai': 'Insights IA',
      'nav.analytics': 'Analisi',
      'nav.settings': 'Impostazioni',
      'nav.profile': 'Profilo',
      'nav.logout': 'Disconnetti',
      'trading.buy': 'Acquista',
      'trading.sell': 'Vendi',
      'trading.quantity': 'Quantit√†',
      'trading.price': 'Prezzo',
      'trading.total': 'Totale',
      'trading.execute': 'Esegui Operazione',
      'common.loading': 'Caricamento...',
      'common.error': 'Errore',
      'common.success': 'Successo'
    };
  }

  getPortugueseTranslations() {
    return {
      'nav.dashboard': 'Painel',
      'nav.trading': 'Trading',
      'nav.portfolio': 'Carteira',
      'nav.market': 'Mercado',
      'nav.ai': 'Insights IA',
      'nav.analytics': 'An√°lises',
      'nav.settings': 'Configura√ß√µes',
      'nav.profile': 'Perfil',
      'nav.logout': 'Sair',
      'trading.buy': 'Comprar',
      'trading.sell': 'Vender',
      'trading.quantity': 'Quantidade',
      'trading.price': 'Pre√ßo',
      'trading.total': 'Total',
      'trading.execute': 'Executar Opera√ß√£o',
      'common.loading': 'Carregando...',
      'common.error': 'Erro',
      'common.success': 'Sucesso'
    };
  }

  getRussianTranslations() {
    return {
      'nav.dashboard': '–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è',
      'nav.trading': '–¢–æ—Ä–≥–æ–≤–ª—è',
      'nav.portfolio': '–ü–æ—Ä—Ç—Ñ–µ–ª—å',
      'nav.market': '–†—ã–Ω–æ–∫',
      'nav.ai': '–ò–ò –ê–Ω–∞–ª–∏—Ç–∏–∫–∞',
      'nav.analytics': '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞',
      'nav.settings': '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
      'nav.profile': '–ü—Ä–æ—Ñ–∏–ª—å',
      'nav.logout': '–í—ã–π—Ç–∏',
      'trading.buy': '–ö—É–ø–∏—Ç—å',
      'trading.sell': '–ü—Ä–æ–¥–∞—Ç—å',
      'trading.quantity': '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ',
      'trading.price': '–¶–µ–Ω–∞',
      'trading.total': '–ò—Ç–æ–≥–æ',
      'trading.execute': '–í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–¥–µ–ª–∫—É',
      'common.loading': '–ó–∞–≥—Ä—É–∑–∫–∞...',
      'common.error': '–û—à–∏–±–∫–∞',
      'common.success': '–£—Å–ø–µ—Ö'
    };
  }

  getChineseTranslations() {
    return {
      'nav.dashboard': '‰ª™Ë°®Êùø',
      'nav.trading': '‰∫§Êòì',
      'nav.portfolio': 'ÊäïËµÑÁªÑÂêà',
      'nav.market': 'Â∏ÇÂú∫',
      'nav.ai': 'AIÊ¥ûÂØü',
      'nav.analytics': 'ÂàÜÊûê',
      'nav.settings': 'ËÆæÁΩÆ',
      'nav.profile': '‰∏™‰∫∫ËµÑÊñô',
      'nav.logout': 'ÈÄÄÂá∫ÁôªÂΩï',
      'trading.buy': '‰π∞ÂÖ•',
      'trading.sell': 'ÂçñÂá∫',
      'trading.quantity': 'Êï∞Èáè',
      'trading.price': '‰ª∑Ê†º',
      'trading.total': 'ÊÄªËÆ°',
      'trading.execute': 'ÊâßË°å‰∫§Êòì',
      'common.loading': 'Âä†ËΩΩ‰∏≠...',
      'common.error': 'ÈîôËØØ',
      'common.success': 'ÊàêÂäü'
    };
  }

  getJapaneseTranslations() {
    return {
      'nav.dashboard': '„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ',
      'nav.trading': '„Éà„É¨„Éº„Éá„Ç£„É≥„Ç∞',
      'nav.portfolio': '„Éù„Éº„Éà„Éï„Ç©„É™„Ç™',
      'nav.market': '„Éû„Éº„Ç±„ÉÉ„Éà',
      'nav.ai': 'AI„Ç§„É≥„Çµ„Ç§„Éà',
      'nav.analytics': '„Ç¢„Éä„É™„ÉÜ„Ç£„ÇØ„Çπ',
      'nav.settings': 'Ë®≠ÂÆö',
      'nav.profile': '„Éó„É≠„Éï„Ç£„Éº„É´',
      'nav.logout': '„É≠„Ç∞„Ç¢„Ç¶„Éà',
      'trading.buy': 'Ë≤∑„ÅÑ',
      'trading.sell': 'Â£≤„Çä',
      'trading.quantity': 'Êï∞Èáè',
      'trading.price': '‰æ°Ê†º',
      'trading.total': 'ÂêàË®à',
      'trading.execute': 'ÂèñÂºïÂÆüË°å',
      'common.loading': 'Ë™≠„ÅøËæº„Åø‰∏≠...',
      'common.error': '„Ç®„É©„Éº',
      'common.success': 'ÊàêÂäü'
    };
  }

  getKoreanTranslations() {
    return {
      'nav.dashboard': 'ÎåÄÏãúÎ≥¥Îìú',
      'nav.trading': 'Ìä∏Î†àÏù¥Îî©',
      'nav.portfolio': 'Ìè¨Ìä∏Ìè¥Î¶¨Ïò§',
      'nav.market': 'ÏãúÏû•',
      'nav.ai': 'AI Ïù∏ÏÇ¨Ïù¥Ìä∏',
      'nav.analytics': 'Î∂ÑÏÑù',
      'nav.settings': 'ÏÑ§Ï†ï',
      'nav.profile': 'ÌîÑÎ°úÌïÑ',
      'nav.logout': 'Î°úÍ∑∏ÏïÑÏõÉ',
      'trading.buy': 'Îß§Ïàò',
      'trading.sell': 'Îß§ÎèÑ',
      'trading.quantity': 'ÏàòÎüâ',
      'trading.price': 'Í∞ÄÍ≤©',
      'trading.total': 'Ï¥ùÌï©',
      'trading.execute': 'Í±∞Îûò Ïã§Ìñâ',
      'common.loading': 'Î°úÎî© Ï§ë...',
      'common.error': 'Ïò§Î•ò',
      'common.success': 'ÏÑ±Í≥µ'
    };
  }

  getArabicTranslations() {
    return {
      'nav.dashboard': 'ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ',
      'nav.trading': 'ÿßŸÑÿ™ÿØÿßŸàŸÑ',
      'nav.portfolio': 'ÿßŸÑŸÖÿ≠ŸÅÿ∏ÿ©',
      'nav.market': 'ÿßŸÑÿ≥ŸàŸÇ',
      'nav.ai': 'ÿ±ÿ§Ÿâ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä',
      'nav.analytics': 'ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™',
      'nav.settings': 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
      'nav.profile': 'ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä',
      'nav.logout': 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨',
      'trading.buy': 'ÿ¥ÿ±ÿßÿ°',
      'trading.sell': 'ÿ®Ÿäÿπ',
      'trading.quantity': 'ÿßŸÑŸÉŸÖŸäÿ©',
      'trading.price': 'ÿßŸÑÿ≥ÿπÿ±',
      'trading.total': 'ÿßŸÑŸÖÿ¨ŸÖŸàÿπ',
      'trading.execute': 'ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿµŸÅŸÇÿ©',
      'common.loading': 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...',
      'common.error': 'ÿÆÿ∑ÿ£',
      'common.success': 'ŸÜÿ¨ÿ≠'
    };
  }

  async initializeFormats() {
    // Date formats
    this.dateFormats.set('en', {
      short: 'MM/dd/yyyy',
      medium: 'MMM dd, yyyy',
      long: 'MMMM dd, yyyy',
      time: 'HH:mm:ss',
      datetime: 'MM/dd/yyyy HH:mm:ss'
    });

    this.dateFormats.set('es', {
      short: 'dd/MM/yyyy',
      medium: 'dd MMM yyyy',
      long: 'dd MMMM yyyy',
      time: 'HH:mm:ss',
      datetime: 'dd/MM/yyyy HH:mm:ss'
    });

    this.dateFormats.set('ar', {
      short: 'yyyy/MM/dd',
      medium: 'yyyy MMM dd',
      long: 'yyyy MMMM dd',
      time: 'HH:mm:ss',
      datetime: 'yyyy/MM/dd HH:mm:ss'
    });

    // Number formats
    this.numberFormats.set('en', {
      decimal: '.',
      thousands: ',',
      precision: 2
    });

    this.numberFormats.set('de', {
      decimal: ',',
      thousands: '.',
      precision: 2
    });

    this.numberFormats.set('ar', {
      decimal: '.',
      thousands: ',',
      precision: 2
    });

    // Currency formats
    this.currencyFormats.set('en', {
      symbol: '$',
      position: 'before',
      precision: 2
    });

    this.currencyFormats.set('es', {
      symbol: '‚Ç¨',
      position: 'after',
      precision: 2
    });

    this.currencyFormats.set('ar', {
      symbol: 'ÿ±.ÿ≥',
      position: 'after',
      precision: 2
    });

    logger.info('‚úÖ Initialized date, number, and currency formats');
  }

  async setupPluralizationRules() {
    // English pluralization rules
    this.pluralizationRules.set('en', {
      one: 'one',
      other: 'other'
    });

    // Spanish pluralization rules
    this.pluralizationRules.set('es', {
      one: 'one',
      other: 'other'
    });

    // Russian pluralization rules
    this.pluralizationRules.set('ru', {
      one: 'one',
      few: 'few',
      many: 'many',
      other: 'other'
    });

    // Arabic pluralization rules
    this.pluralizationRules.set('ar', {
      zero: 'zero',
      one: 'one',
      two: 'two',
      few: 'few',
      many: 'many',
      other: 'other'
    });

    logger.info('‚úÖ Setup pluralization rules for all languages');
  }

  // Public methods
  translate(key, params = {}, language = null) {
    const lang = language || this.currentLanguage;
    const translations = this.translations.get(lang) || this.translations.get(this.fallbackLanguage);

    let translation = translations[key] || key;

    // Replace parameters
    if (params && typeof params === 'object') {
      Object.keys(params).forEach(param => {
        translation = translation.replace(`{{${param}}}`, params[param]);
      });
    }

    return translation;
  }

  setLanguage(languageCode) {
    if (this.supportedLanguages.has(languageCode)) {
      this.currentLanguage = languageCode;
      this.emit('languageChanged', languageCode);
      logger.info(`üåç Language changed to: ${languageCode}`);
      return { success: true, message: 'Language changed successfully' };
    } else {
      logger.warn(`Language not supported: ${languageCode}`);
      return { success: false, error: 'Language not supported' };
    }
  }

  getCurrentLanguage() {
    return this.currentLanguage;
  }

  getSupportedLanguages() {
    return Array.from(this.supportedLanguages.values()).filter(lang => lang.enabled);
  }

  isRTL(languageCode = null) {
    const lang = languageCode || this.currentLanguage;
    return this.rtlLanguages.has(lang);
  }

  formatDate(date, format = 'medium', language = null) {
    const lang = language || this.currentLanguage;
    const dateFormat = this.dateFormats.get(lang) || this.dateFormats.get('en');

    // In real implementation, use a proper date formatting library
    return new Intl.DateTimeFormat(lang, {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    }).format(date);
  }

  formatNumber(number, options = {}, language = null) {
    const lang = language || this.currentLanguage;

    return new Intl.NumberFormat(lang, {
      minimumFractionDigits: options.precision || 2,
      maximumFractionDigits: options.precision || 2,
      ...options
    }).format(number);
  }

  formatCurrency(amount, currency = 'USD', language = null) {
    const lang = language || this.currentLanguage;

    return new Intl.NumberFormat(lang, {
      style: 'currency',
      currency: currency
    }).format(amount);
  }

  getPluralForm(count, key, language = null) {
    const lang = language || this.currentLanguage;
    const rules = this.pluralizationRules.get(lang) || this.pluralizationRules.get('en');

    // In real implementation, use proper pluralization logic
    if (count === 1) {
      return this.translate(`${key}.one`, { count }, language);
    } else {
      return this.translate(`${key}.other`, { count }, language);
    }
  }

  detectLanguage(userAgent, acceptLanguage) {
    // Simple language detection
    if (acceptLanguage) {
      const languages = acceptLanguage.split(',').map(lang => {
        const [code] = lang.trim().split(';');
        return code.toLowerCase();
      });

      for (const lang of languages) {
        if (this.supportedLanguages.has(lang)) {
          return lang;
        }
      }
    }

    return this.fallbackLanguage;
  }

  getLanguageInfo(languageCode) {
    return this.supportedLanguages.get(languageCode);
  }

  getTranslationCompleteness(languageCode) {
    const info = this.supportedLanguages.get(languageCode);
    return info ? info.completeness : 0;
  }

  // API endpoints for frontend
  getTranslationData(languageCode = null) {
    const lang = languageCode || this.currentLanguage;
    const translations = this.translations.get(lang) || this.translations.get(this.fallbackLanguage);

    return {
      language: lang,
      translations: translations,
      isRTL: this.isRTL(lang),
      dateFormat: this.dateFormats.get(lang),
      numberFormat: this.numberFormats.get(lang),
      currencyFormat: this.currencyFormats.get(lang)
    };
  }

  getAllSupportedLanguages() {
    return Array.from(this.supportedLanguages.values());
  }

  getStatus() {
    return {
      isInitialized: this.isInitialized,
      currentLanguage: this.currentLanguage,
      supportedLanguages: this.supportedLanguages.size,
      translationsLoaded: this.translations.size,
      rtlLanguages: this.rtlLanguages.size
    };
  }
}

module.exports = new InternationalizationManager();

