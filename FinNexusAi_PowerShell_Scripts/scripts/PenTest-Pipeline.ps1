# PenTest-Pipeline.ps1
# Requires: git clone https://github.com/samratashok/nishang.git; . .\nishang\Invoke-Encode.ps1

param(
    [string]$TargetIP = "127.0.0.1",
    [string]$Port = "3000"  # FinAI Nexus frontend port
)

# Download/Run Nishang for port scan and vuln check
$nishangPath = ".\nishang"
if (-not (Test-Path $nishangPath)) { git clone https://github.com/samratashok/nishang.git }
. $nishangPath\Recon\Invoke-PortScan.ps1

# Scan for open ports/vulns
$results = Invoke-PortScan -Target $TargetIP -Ports 80,443,$Port -Timeout 5
$results | Where-Object { $_.Status -eq 'Open' } | ForEach-Object {
    Write-Host "Vuln Port Open: $($_.Port) on $TargetIP" -ForegroundColor Red
    # Simulate basic exploit check (e.g., directory traversal on API)
    $vulnCheck = Invoke-WebRequest -Uri "http://$TargetIP`:$Port/api/v1/test?file=../../../etc/passwd" -UseBasicParsing -ErrorAction SilentlyContinue
    if ($vulnCheck.StatusCode -eq 200) { Write-Host "Potential Dir Traversal!" -ForegroundColor Red }
}

# Generate report
$results | Export-Csv -Path ".\reports\pentest-$(Get-Date -Format 'yyyyMMdd').csv" -NoTypeInformation
Write-Host "PenTest complete. Report: .\reports\pentest-*.csv" -ForegroundColor Green
